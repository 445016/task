{template '../../../addons/'.MODULE.'/template/web/'.$_W['mtemp'].'/common/myheader'}

<div class="list-content">

{if $_GPC['op'] == 'add' || $_GPC['op'] == 'edit'}
    <div class="table-wrap" >
		<form method="post" action="">
			<div class="form-row  " >
                <label>排序序号</label>
                <div class="form-value">
                    <esui-text-box class="ui-ctrl ui-textbox">
                        <input type="text" class="frm_input"  name="number" value="{$info['number']}">
                    </esui-text-box>
                    <p class="note input_500">填入数字，越大越前</p>
                </div>
            </div>
			<div class="form-row  " >
                <label>模板名称</label>
                <div class="form-value">
                    <esui-text-box class="ui-ctrl ui-textbox">
                       	<input type="text" class="frm_input"  name="title" value="{$info['name']}">
                    </esui-text-box>
                </div>
            </div>
            <div class="form-row  " >
                <label>表单内容</label>
                <div class="form-value">
					<div class="rule_append_box input_550">
						<div class="item_cell_box good_rule_body good_taskform_body">
							<div class="input_title"></div>
							<div class="input_form item_cell_flex">
								<div class="good_rule_list appoint_list multi-img-details">

									<!-- <div class="good_rule_item appoint_box_item" ng-repeat="item in rule">
										<div class="appoint_form_item">
											<div>
												名称<span class="frm_input_box frm_input_150">
													<input type="text" class="frm_input"  name="name[]" >
												</span>
												提示文字<span class="frm_input_box frm_input_150">
													<input type="text" class="frm_input"  name="pla[]" >
												</span>	<span class="font_mini">(时间)</span>
												<a href="javascript:;" class="delete_appoint_item">删除</a>	
											</div>
											<div class="appoint_additem">
												<span class="appoint_additem_item">发完全放</span>
											</div>
											<div class="appoint_additem">
												<span class="frm_input_box frm_input_150">
													<input type="text" class="frm_input editvalue_{{item.pro.id}}"  name="editvalue" >
												</span>
												<a href="javascript:;" ng-click="addRuleData(item.pro.id)">添加选项</a>
											</div>
										</div>
									</div> -->
									{loop $info['form'] $item}
										<div class="good_rule_item appoint_box_item">
											<input type="hidden" name="aid[]" value="{$item['id']}">
											<input type="hidden" name="type[{$item['id']}]" value="{$item['type']}">
											<div class="appoint_form_item">
												<div>
													名称<span class="frm_input_box frm_input_150">
														<input type="text" class="frm_input"  name="name[{$item['id']}]" value="{$item['name']}">
													</span>
													{if $item['type'] == 'img'}
													需传图片<span class="frm_input_box frm_input_150">
														<input type="text" class="frm_input"  name="maxnum[{$item['id']}]" value="{$item['maxnum']}" placeholder="填数字">
													</span>
													{else}
														提示文字<span class="frm_input_box frm_input_150">
															<input type="text" class="frm_input"  name="pla[{$item['id']}]" value="{$item['pla']}">
														</span>
													{/if}
													<span class="font_mini">
													( {if $item['type'] == 'text'}段落文字
													{elseif $item['type'] == 'font'}文字
													{elseif $item['type'] == 'card'}身份证
													{elseif $item['type'] == 'num'}数字
													{elseif $item['type'] == 'email'}邮箱
													{elseif $item['type'] == 'tel'}电话号码
													{elseif $item['type'] == 'img'}上传图片
													{/if})</span>
													<a href="javascript:;" class="delete_appoint_item">删除</a>	
												</div>
											</div>
										</div>
									{/loop}
								</div>
								<div class="add_a_rule_box">
									<p class="font_999">添加表单</p>
									<a href="javascript:;" class="add_appoint" type="text">段落文字</a>
									<a href="javascript:;" class="add_appoint" type="font">文字</a>
									<a href="javascript:;" class="add_appoint" type="card">身份证</a>
									<a href="javascript:;" class="add_appoint" type="num">数字</a>
									<a href="javascript:;" class="add_appoint" type="email">邮箱</a>
									<a href="javascript:;" class="add_appoint" type="tel">电话号码</a>
									<a href="javascript:;" class="add_appoint" type="img">上传图片</a>
								</div>
								
							</div>
						</div>
					</div>
                </div>
            </div>
			<div class="form-row  " >
                <label>提示</label>
                <div class="form-value note input_500">
                    任务表单是用在普通任务中，在发布任务的时候可选择使用表单模板来控制任务执行者需要回复的任务内容。内容内的名称建议设置4个文
                </div>
            </div>
			
            <div class="form-row">
                <label></label>
                <div class="form-value">
                    <input name="create" type="submit" value="确定" class="ui-button skin-ok-button" />
                    <input name="token" type="hidden" value="{$_W['token']}" />
                </div>
            </div>
		</form>
	</div>
{elseif $_GPC['op'] == 'list'}

<form action="" method="post">
    <div class="table-full-wrap" >

        <div class="operation-wrap" data-follow-thead="table">
            <div class="buttons-wrap" style="height: 30px;">
            </div>
            <div class="buttons-quick-wrap">
                <a href="{php echo $this->createWebUrl('taskform',array('op'=>'add'))}" class="ui-ctrl ui-button skin-ok-button " >添加表单模板</a>
            </div>
        </div>

        <div class="ui-ctrl ui-table ui-table-filter"> 
            <div class="ui-table-head" style=" top: 0px; left: 0px;">
            <div class="ui-ctrl ui-panel">
            <table cellpadding="0" cellspacing="0" width="100%">
            <tbody>
                <tr>
                    <th class="ui-table-hcell" >
                        <div class="ui-table-hcell-text ui-table-hcell-text-first ui-table-hcell-sel">
                            <input type="checkbox" class="ui-table-select-all" />id
                        </div>
                    </th>
                    <th class="ui-table-hcell ui-table-hcell-sort" >
                        <div class="ui-table-hcell-text">模板名称</div>
                    </th>
                    <th class="ui-table-hcell hcell-filter" >
                        <div class="ui-table-hcell-text">排序</div>
                    </th>
                    <th class="ui-table-hcell"  >
                        <div class="ui-table-hcell-text ui-table-hcell-text-last">操作</div>
                    </th>
                </tr>
            </tbody>
            </table>
            </div>
            </div>
            <div class="ui-table-body">
            <div class="ui-ctrl ui-panel">
            {loop $list $item}    
            <div class="ui-table-row ui-table-row-even" >  
            <table cellpadding="0" cellspacing="0" width="100%" data-control-table="table">
            <tbody>
                <tr>
                    <td id="ctrl-e-table-cell0-0" class="ui-table-cell" >
                        <div class="ui-table-cell-text ui-table-cell-text-first ui-table-cell-sel">
                            <input type="checkbox" class="ui-table-multi-select" name="checkall[]" value="{$item['id']}" />{$item['id']}
                        </div>
                    </td> 		     		
                    <td id="ctrl-e-table-cell0-1" class="ui-table-cell" >
                        <div class="ui-table-cell-text">
			     			{$item['name']}
                        </div>
                    </td>
                    <td class="ui-table-cell"  >
                        <div class="ui-table-cell-text">
							<span class="edit_number">
			    				<input type="text" id="{$item['id']}" inputname="taskformnumber" inputtype="text" value="{$item['number']}" class="edit_number_input tl">
			    			</span>
                        </div>
                    </td>
                    <td class="ui-table-cell"  >
                        <div class="ui-table-cell-text-last">
				    		<a href="{php echo $this->createWebUrl('taskform',array('op'=>'edit','id'=>$item['id']))}" class="" id="{$item['id']}">编辑</a>
				    		<a href="{php echo $this->createWebUrl('taskform',array('op'=>'deleteform','id'=>$item['id']))}" onclick="return confirm('删除不能恢复，确定要删除吗？');">删除</a>
                        </div>
                    </td>
                </tr>
            </tbody>
            </table>
            </div>
            {/loop}
            </div>
            </div>
        </div>
    </div>
    <div class="ui-row">
        <div class="bot_btnlist fl">
            <input name="deleteallform" class="ui-button ui-dialog-ok-btn" value="删除所选" onclick="return confirm('确定要删除选择的吗？');" type="submit">
            <input type="hidden" name="token" value="{$_W['token']}">
        </div>
        <div class="ui-pager">
            {$pager}
        </div> 
    </div>
</form> 
{/if}

</div>


<div class="my_model" addform style="display: none">
    <div class=" ui-draggable " >
        <div class="dialog">
            <div class="dialog_hd">
                <a href="javascript:;" class="icon16_opr closed pop_closed model_close" >关闭</a>
            </div>
            <div class="dialog_bd info_box addform_item" >
                
                <div class="frm_control_group">
                    <label for="" class="frm_label">表单名称</label>
                    <div class="frm_controls">
                        <span class="frm_input_box">
                            <input type="text" class="frm_input" name="name" value="">
                        </span>
                    </div>
                </div>
                <div class="frm_control_group">
                    <label for="" class="frm_label">排序序号</label>
                    <div class="frm_controls">
                        <span class="frm_input_box">
                            <input type="text" class="frm_input" name="number" value="">
                        </span>
                        <p class="frm_tips frm_tips_default">填数字，数字越大越靠前</p>
                    </div>
                </div>


            </div>
            <div class="dialog_ft">
                <span class="btn btn_primary btn_input js_btn_p" id="confirm_addform" >
                    <button type="button" class="js_btn">保存</button>
                </span>
                <span class="btn btn_default btn_input js_btn_p model_close" >
                    <button type="button" class="js_btn">取消</button>
                </span>
            </div>
        </div>
    </div>
    <div class="mask ui-draggable" style="display: block;"></div>
</div>


<script type="text/javascript">
	$(function(){
		var fid = 0;
		$('.edit_listitem').click(function(){
			var nowfid = $(this).attr('id');
			Http('post','json','findform',{fid:nowfid},function(data){
				if(data.status == 200){
					fid = nowfid; // 防止取消后再添加异常
					$('input[name=name]').val(data.obj.name);
					$('input[name=number]').val(data.obj.number);
					$('input[name=formtype]').val(data.obj.formtype);

					var act = $('.select_item[id="'+data.obj.formtype+'"]');
					var name = act.text();
					$('.my_model[addform]').find('.jsBtLabel').text(name);
					$('.my_model[addform]').show();
				}else{
					webAlert(data.res);
				}
			},true);
		});
		
		$('#confirm_addform').click(function(){
			var postdata = {
				fid : fid,
				name : $('input[name=name]').val(),
				number : $('input[name=number]').val(),
				formtype : $('input[name=formtype]').val(),
			};
			Http('post','json','addform',postdata,function(data){
				if(data.status == 200){
					webAlert(data.res);
					setTimeout(function(){
						location.href = '';
					},500);
				}else{
					webAlert(data.res);
				}
			},true);

		});

	});
</script>
{template '../../../addons/'.MODULE.'/template/web/bdui/common/copyright'}  	
{template 'common/footer'}
