 
    <div class="table-full-wrap" >

        <div class="operation-wrap" data-follow-thead="table">
            <div class="buttons-wrap" style="height: 30px;">
            </div>
            <div class="buttons-quick-wrap">
                <a href="javascript:;" class="ui-ctrl ui-button skin-ok-button topbar_jsbtn" js="addform" >添加表单</a>
            </div>
        </div>

	<form action="" method="post">
        <div class="ui-ctrl ui-table ui-table-filter"> 
            <div class="ui-table-head" style=" top: 0px; left: 0px;">
            <div class="ui-ctrl ui-panel">
            <table cellpadding="0" cellspacing="0" width="100%">
            <tbody>
                <tr>
                    <th class="ui-table-hcell" >
                        <div class="ui-table-hcell-text ui-table-hcell-text-first ui-table-hcell-sel">
                            <input type="checkbox" class="ui-table-select-all" />id
                        </div>
                    </th>
                    <th class="ui-table-hcell ui-table-hcell-sort" >
                        <div class="ui-table-hcell-text">表单名称</div>
                    </th>
                    <th class="ui-table-hcell hcell-filter" >
                        <div class="ui-table-hcell-text">类型</div>
                    </th>
                    <th class="ui-table-hcell hcell-filter" >
                        <div class="ui-table-hcell-text">排序</div>
                    </th>
                    <th class="ui-table-hcell"  >
                        <div class="ui-table-hcell-text ui-table-hcell-text-last">操作</div>
                    </th>
                </tr>
            </tbody>
            </table>
            </div>
            </div>
            <div class="ui-table-body">
            <div class="ui-ctrl ui-panel">
            {loop $list $item}    
            <div class="ui-table-row ui-table-row-even" >  
            <table cellpadding="0" cellspacing="0" width="100%" data-control-table="table">
            <tbody>
                <tr>
                    <td id="ctrl-e-table-cell0-0" class="ui-table-cell" >
                        <div class="ui-table-cell-text ui-table-cell-text-first ui-table-cell-sel">
                            <span>
                                <input type="checkbox" class="ui-table-multi-select" name="checkall[]" value="{$item['id']}" />{$item['id']}
                            </span>
                        </div>
                    </td>
                    <td id="ctrl-e-table-cell0-1" class="ui-table-cell" >
                        <div class="ui-table-cell-text">
			     			{$item['name']}
                        </div>
                    </td>
                    <td class="ui-table-cell" >
                        <div class="ui-table-cell-text" >
			    			{if $item['formtype'] == 'char'}文字{/if}
			    			{if $item['formtype'] == 'int'}整数{/if}
			    			{if $item['formtype'] == 'image'}图片{/if}
			    			{if $item['formtype'] == 'mobile'}手机{/if}
			    			{if $item['formtype'] == 'city'}城市{/if}
			    			{if $item['formtype'] == 'time'}时间{/if}
                        </div>
                    </td>
                    <td class="ui-table-cell"  >
                        <div class="ui-table-cell-text">
							<span class="edit_number">
			    				<input type="text" id="{$item['id']}" inputname="tasksortnumber" inputtype="text" value="{$item['number']}" class="edit_number_input tl">
			    			</span>
                        </div>
                    </td>
                    <td class="ui-table-cell"  >
                        <div class="ui-table-cell-text-last">
					    	<a href="javascript:;" class="edit_listitem" id="{$item['id']}">编辑</a>
					    	<a href="{php echo $this->createWebUrl('userdata',array('op'=>'deleteform','id'=>$item['id']))}" onclick="return confirm('删除不能恢复，确定要删除吗？');">删除</a>
                        </div>
                    </td>
                </tr>
            </tbody>
            </table>
            </div>
            {/loop}
            </div>
            </div>
        </div>
    </div>
    <div class="ui-row">
        <div class="bot_btnlist fl">
            <input name="deleteallform" class="ui-button ui-dialog-ok-btn" value="删除所选" onclick="return confirm('确定要删除选择的吗？');" type="submit">
            <input type="hidden" name="token" value="{$_W['token']}">
        </div>
        <div class="ui-pager">
            {$pager}
        </div>
	</form>       
    </div>



<div class="my_model form_model" addform>
<esui-dialog class="ui-dialog skin-confirm in modala" >
	<div class="dialog_body">
	    <div class="ui-dialog-head" >
	        <div class="ui-dialog-title">添加表单</div>
	    </div>
	    <div class="ui-dialog-body-panel " >
                <div class="form-row" >
                    <label>表单名称</label>
                    <div class="form-value">
                        <esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_300" name="name" value="">
                        </esui-text-box>
                    </div>
                </div>
                <div class="form-row" >
                    <label>排序序号</label>
                    <div class="form-value">
                        <esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_300" name="number" value="">
                        </esui-text-box>
                        <p class="note frm_tips_default">填数字，数字越大越靠前</p>
                    </div>
                </div>
                <div class="form-row" >
                    <label>排序序号</label>
                    <div class="form-value">
                        <esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_300" name="number" value="">
                        </esui-text-box>
                        <p class="note frm_tips_default">填数字，数字越大越靠前</p>
                    </div>
                </div>
	            <div class="form-row">
	                <label>表单类型</label>
	                <div class="form-value">
	                	<div class="ui-select-out input_300">
							<div class="ui-select">
								<span class="ui-select-text">
									表单类型
								</span>
							</div>
							<ol class="ui-select-layer ui-layer" >
								<li data-value="char" class="ui-select-item ">
									<span title="">文字</span>
								</li>
								<li data-value="int" class="ui-select-item ">
									<span title="">整数</span>
								</li>
								<li data-value="image" class="ui-select-item ">
									<span title="">图片</span>
								</li>
								<li data-value="mobile" class="ui-select-item ">
									<span title="">手机</span>
								</li>
								<li data-value="time" class="ui-select-item">
									<span title="">时间</span>
								</li>
								<li data-value="city" class="ui-select-item {if $remote['cos']['local'] == 'gz'}ui-select-item-selected{/if}">
									<span title="">城市</span>
								</li>
							</ol>
							<input type="hidden" class="ui-select-input" name="formtype" value="">
	                	</div>
	                </div>
	            </div>

                <div class="form-row" >
                    <label>绑定标签</label>
                    <div class="form-value">
                        <div class="ui-boxgroup ui-boxgroup-horizontal">
                            {loop $useric $item}
                            <label  class="ui-boxgroup-radio" >
                                <input type="checkbox" class="frm_checkbox usericv" value="{$item['id']}" name="useric[]" /> 
                                <span>{$item['name']}</span>
                            </label>
                            {/loop}
                            <p class="note frm_tips_default">审核会员通过后，自动绑定选择的标签</p>
                        </div>
                    </div>
                </div>

	    </div>
	    <div class="ui-dialog-foot-panel tr" >
	        <a href="javascript:;" class="ui-dialog-ok-btn ui-button" id="confirm_addform" >确定</a>
	        <a href="javascript:;" class="skin-cancel-button ui-button" data-dismiss="modal">取消</a>
	    </div>
	</div>
</esui-dialog>
<div class="modal-backdrop in"></div>
</div>


<script type="text/javascript">
	$(function(){

        $('.topbar_jsbtn').click(function(){
            fid = 0;
        })
        
		var fid = 0;
		$('.edit_listitem').click(function(){
			var nowfid = $(this).attr('id');
			Http('post','json','findform',{fid:nowfid},function(data){
				if(data.status == 200){
					fid = nowfid; // 防止取消后再添加异常
					$('input[name=name]').val(data.obj.name);
					$('input[name=number]').val(data.obj.number);
					$('input[name=formtype]').val(data.obj.formtype);


                    $('.usericv').each(function(){
                        $(this).prop('checked',false);
                        $(this).parents('.frm_checkbox_label').removeClass('selected');
                    })

                    if( data.obj.useric && data.obj.useric.length > 0 ){
                        for (var i = 0; i < data.obj.useric.length; i++) {
                            $('.usericv').each(function(){
                                if( $(this).val() == data.obj.useric[i] ){
                                    $(this).prop('checked',true);
                                    $(this).parents('.frm_checkbox_label').addClass('selected');
                                }
                            })
                        }
                    }

					var act = $('.ui-select-item[data-value="'+data.obj.formtype+'"]');
					var name = act.text();
					$('.my_model[addform]').find('.ui-select .ui-select-text').text(name);
					$('.my_model[addform]').show();
				}else{
					webAlert(data.res);
				}
			},true);
		});
		
		$('#confirm_addform').click(function(){
			var postdata = {
				fid : fid,
				name : $('input[name=name]').val(),
				number : $('input[name=number]').val(),
				formtype : $('input[name=formtype]').val(),
			};

            postdata.usericarr = arrval( $('input[name="useric[]"]:checked') );

			Http('post','json','addform',postdata,function(data){
				if(data.status == 200){
					webAlert(data.res);
					setTimeout(function(){
						location.href = '';
					},500);
				}else{
					webAlert(data.res);
				}
			},true);

		});

	});
</script>