
    <div class="table-full-wrap" >

        <div class="operation-wrap" data-follow-thead="table">
            <div class="buttons-wrap" style="height: 30px;">
            </div>
            <div class="buttons-quick-wrap">
                <a href="javascript:;" class="ui-ctrl ui-button skin-ok-button topbar_jsbtn" js="addtemp" >添加模板内容</a>
            </div>
        </div>

	<form action="" method="post">
        <div class="ui-ctrl ui-table ui-table-filter"> 
            <div class="ui-table-head" style=" top: 0px; left: 0px;">
            <div class="ui-ctrl ui-panel">
            <table cellpadding="0" cellspacing="0" width="100%">
            <tbody>
                <tr>
                    <th class="ui-table-hcell" >
                        <div class="ui-table-hcell-text ui-table-hcell-text-first ui-table-hcell-sel">
                            <input type="checkbox" class="ui-table-select-all" />id
                        </div>
                    </th>
                    <th class="ui-table-hcell ui-table-hcell-sort" >
                        <div class="ui-table-hcell-text">模板名称</div>
                    </th>
                    <th class="ui-table-hcell hcell-filter" >
                        <div class="ui-table-hcell-text">排序序号</div>
                    </th>
                    <th class="ui-table-hcell hcell-filter" >
                        <div class="ui-table-hcell-text">状态</div>
                    </th>
                    <th class="ui-table-hcell"  >
                        <div class="ui-table-hcell-text ui-table-hcell-text-last">操作</div>
                    </th>
                </tr>
            </tbody>
            </table>
            </div>
            </div>
            <div class="ui-table-body">
            <div class="ui-ctrl ui-panel">
            {loop $list $item}    
            <div class="ui-table-row ui-table-row-even" >  
            <table cellpadding="0" cellspacing="0" width="100%" data-control-table="table">
            <tbody>
                <tr>
                    <td id="ctrl-e-table-cell0-0" class="ui-table-cell" >
                        <div class="ui-table-cell-text ui-table-cell-text-first ui-table-cell-sel">
                            <input type="checkbox" class="ui-table-multi-select" name="checkall[]" value="{$item['id']}" />{$item['id']}
                        </div>
                    </td>
                    <td id="ctrl-e-table-cell0-1" class="ui-table-cell" >
                        <div class="ui-table-cell-text">
			     			{$item['name']}
                        </div>
                    </td>
                    <td class="ui-table-cell" >
                        <div class="ui-table-cell-text" >
			    			{$item['number']}
                        </div>
                    </td>
                    <td class="ui-table-cell"  >
                        <div class="ui-table-cell-text">
							<span class="edit_number">
				    			{if $item['status'] == 0}
				    				正常
				    			{elseif $item['status'] == 1}
				    				<span class="font_ff5f27">下架</span>
				    			{/if}
	    					</span>
                        </div>
                    </td>
                    <td class="ui-table-cell"  >
                        <div class="ui-table-cell-text-last">
			    			<a  href="javascript:;" class="edit_listitem" id="{$item['id']}">编辑</a>
			    			<a href="{php echo $this->createWebUrl('tbtask',array('op'=>'deletetbform','id'=>$item['id']))}" onclick="return confirm('删除不能恢复，确定要删除吗？');">删除</a>
                        </div>
                    </td>
                </tr>
            </tbody>
            </table>
            </div>
            {/loop}
            </div>
            </div>
        </div>
    </div>
    <div class="ui-row">
        <div class="bot_btnlist fl">
            <input name="deletetbform" class="ui-button ui-dialog-ok-btn" value="删除所选" onclick="return confirm('确定要删除选择的吗？');" type="submit">
            <input type="hidden" name="token" value="{$_W['token']}">
        </div>
        <div class="ui-pager">
            {$pager}
        </div>
	</form>       
    </div>

<div class="my_model form_model" addtemp>
	<esui-dialog class="ui-dialog skin-confirm in modala" >
		<div class="dialog_body">
		    <div class="ui-dialog-head" >
		    </div>
		    <div class="ui-dialog-body-panel " >
            <form>    
                <div class="form-row">
                    <label>模板名称</label>
                    <div class="form-value">
                        <esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_300"  name="name" value="{$info['name']}">
                        </esui-text-box>
                        <div class="note"></div>
                    </div>
                </div>
                <div class="form-row" >
                    <label>排序序号</label>
                    <div class="form-value">
                        <esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_300"  name="number" value="{$info['number']}">
                        </esui-text-box>
                        <p class="note frm_tips_default">填数字，数字越大越靠前</p>
                    </div>
                </div>
                <div class="form-row">
                    <label>任务标题</label>
                    <div class="form-value">
                        <esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_300"  name="title" value="{$info['title']}">
                        </esui-text-box>
                        <div class="note"></div>
                    </div>
                </div>
                <div class="form-row">
                    <label>任务总量</label>
                    <div class="form-value">
                        <esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_300"  name="num" value="{$info['num']}">
                        </esui-text-box>
                        <div class="note"></div>
                    </div>
                </div>
                <div class="form-row">
                    <label>任务赏金</label>
                    <div class="form-value">
                        <esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_300"  name="money" value="{$info['money']}">
                        </esui-text-box>
                        <div class="note"></div>
                    </div>
                </div>
                <div class="form-row">
                    <label>担保金额</label>
                    <div class="form-value">
                        <esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_300"  name="tbmoney" value="{$info['tbmoney']}">
                        </esui-text-box>
                        <div class="note"></div>
                    </div>
                </div>
                <div class="form-row">
                    <label>任务步骤</label>
                    <div class="form-value">
                        1.<esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_100" name="tbstep1" value="{$info['tbstep1']}">
                        </esui-text-box>
                        2.<esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_100" name="tbstep2" value="{$info['tbstep2']}">
                        </esui-text-box>
                        3.<esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_100" name="tbstep3" value="{$info['tbstep3']}">
                        </esui-text-box>
                        4.<esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_100" name="tbstep4" value="{$info['tbstep4']}">
                        </esui-text-box>
                        5.<esui-text-box class="ui-ctrl ui-textbox">
                            <input type="text" class="input_100" name="tbstep5" value="{$info['tbstep5']}">
                        </esui-text-box>
                    </div>
                </div>
				
				<div class="form-row textarea_item" >
                    <label>任务内容</label>
                    <div class="form-value">
                        {php echo tpl_ueditor('content', htmlspecialchars_decode($info['content']));}
                        <span class="frm_tips note">提示：请不要插入图片</span>
                    </div>
                </div>
                <div class="form-row" >
                    <label>状态</label>
                    <div class="form-value">
                        <div class="ui-boxgroup ui-boxgroup-horizontal">
                            <label  class="ui-boxgroup-radio" showitem=".falseindexdata">
                                <input type="radio" name="status" value="0" class="frm_radio" {if $info['status'] == 0}checked="checked"{/if} />
                                <span>上架</span>
                            </label>
                            <label class="ui-boxgroup-radio" hideitem=".falseindexdata">
                                <input type="radio" name="status" value="1" class="frm_radio" {if $info['status'] == 1}checked="checked"{/if} /> 
                                <span>下架</span>
                            </label>        
                        </div>
                    </div>
                </div>
            </form>    
		    </div>
		    <div class="ui-dialog-foot-panel tr" >
		        <a href="javascript:;" class="ui-dialog-ok-btn ui-button" id="confirm_addform" >确定</a>
		        <a href="javascript:;" class="skin-cancel-button ui-button" data-dismiss="modal">取消</a>
		    </div>
		</div>
	</esui-dialog>
	<div class="modal-backdrop in"></div>
</div>

<script type="text/javascript">
	$(function(){

		$('.topbar_jsbtn').click(function(){
			fid = 0;
		})

		var fid = 0;
		$('.edit_listitem').click(function(){
			var nowfid = $(this).attr('id');
			Http('post','json','findtbform',{fid:nowfid},function(data){
				if(data.status == 200){
					fid = nowfid; // 防止取消后再添加异常
					$('input[name=name]').val(data.obj.name);
                    $('input[name=title]').val(data.obj.title);
					$('input[name=number]').val(data.obj.number);
					$('input[name=money]').val(data.obj.money);
                    $('input[name=tbmoney]').val(data.obj.tbmoney);
                    $('input[name=num]').val(data.obj.num);

                    $('input[name=tbstep1]').val(data.obj.step.step1);
                    $('input[name=tbstep2]').val(data.obj.step.step2);
                    $('input[name=tbstep3]').val(data.obj.step.step3);
                    $('input[name=tbstep4]').val(data.obj.step.step4);
                    $('input[name=tbstep5]').val(data.obj.step.step5);

					if( data.obj.img ) {
						$('input[name=img]').val(data.obj.img);
						if( data.obj.img ) $('.img-thumbnail').attr('src',data.obj.showimg).parent().show();
					}else{
						$('input[name=img]').val('');
						$('.img-thumbnail').attr('src','').parent().hide();
					}
					$('textarea[name=title]').val(data.obj.title);
					$('textarea[name="content"]').val(data.obj.content);

					if( typeof UE == 'undefined' ) {
						alert('加载数据失败，请重试');
						window.location.reload();
						return false;
					}

					var ue = UE.getEditor('content');  
					ue.setContent( data.obj.content );

					

					var act = $('input[name="status"][value="'+data.obj.status+'"]');

					act.prop('checked',true).parents('.frm_controls').find('.frm_radio_label').removeClass('selected');
					act.parent().addClass('selected');
					$('.my_model[addtemp]').show();

				}else{
					webAlert(data.res);
				}
			},true);
		});
		
		$('#confirm_addform').click(function(){
			var postdata = {
				fid : fid,
				name : $('input[name=name]').val(),
				number : $('input[name=number]').val(),
				title : $('input[name=title]').val(),
				num : $('input[name=num]').val(),
				money : $('input[name=money]').val(),
				tbmoney : $('input[name=tbmoney]').val(),
                tbstep1 : $('input[name=tbstep1]').val(),
                tbstep2 : $('input[name=tbstep2]').val(),
                tbstep3 : $('input[name=tbstep3]').val(),
                tbstep4 : $('input[name=tbstep4]').val(),
                tbstep5 : $('input[name=tbstep5]').val(),
				content : $('textarea[name="content"]').val(),
			};
			
			Http('post','json','addtbform',postdata,function(data){
				if(data.status == 200){
					webAlert(data.res);
					setTimeout(function(){
						location.href = '';
					},500);
				}else{
					webAlert(data.res);
				}
			},true);

		});

	});
</script>